2018-12-14 18:27:29,012 INFO     input command: pbs_benchpress -f pbs_hook_execjob_end.py -o PTL_test_after_change.txt
2018-12-14 18:27:29,012 INFO     param: None
2018-12-14 18:27:29,012 INFO     ptl version: 19.0.0
2018-12-14 18:27:29,012 INFO     platform: Linux c7-dev 3.10.0-862.14.4.el7.x86_64 #1 SMP Wed Sep 26 15:12:11 UTC 2018 x86_64 x86_64
2018-12-14 18:27:29,013 INFO     python version: 2.7.5
2018-12-14 18:27:29,013 INFO     user: root
2018-12-14 18:27:29,013 INFO     --------------------------------------------------------------------------------
2018-12-14 18:27:29,013 INFO     Cleaning up temporary files
2018-12-14 18:27:29,013 INFO     Cleaning up /var/tmp dir
2018-12-14 18:27:29,013 INFO     Cleaning up /tmp dir
2018-12-14 18:27:29,022 INFO     ======================================================================
2018-12-14 18:27:29,023 INFO     suite name: TestPbsExecjobEnd
2018-12-14 18:27:29,023 INFO     suite docstring: 

    This tests the feature in PBS that allows
    execjob_end hook to execute such that
    pbs_mom is not blocked upon execution.
    

2018-12-14 18:27:29,023 INFO     ======================================================================
2018-12-14 18:27:29,023 INFO     =====================================
2018-12-14 18:27:29,023 INFO      Entered TestPbsExecjobEnd setUpClass
2018-12-14 18:27:29,023 INFO     =====================================
2018-12-14 18:27:29,023 INFOCLI2 c7-dev: id pbsuser
2018-12-14 18:27:29,026 INFOCLI2 c7-dev: id pbsuser1
2018-12-14 18:27:29,029 INFOCLI2 c7-dev: id pbsuser2
2018-12-14 18:27:29,035 INFOCLI2 c7-dev: id pbsuser3
2018-12-14 18:27:29,049 INFO     server c7-dev: server operating mode set to cli
2018-12-14 18:27:29,049 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Bf c7-dev
2018-12-14 18:27:29,088 INFO     server c7-dev: version 19.0.0
2018-12-14 18:27:29,088 INFO     expect action: created new action kicksched
2018-12-14 18:27:29,088 INFO     expect action: added action kicksched to server c7-dev
2018-12-14 18:27:29,117 INFOCLI2 c7-dev: sudo -H /opt/pbs/sbin/pbsfs
2018-12-14 18:27:29,150 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/sched_priv/resource_group
2018-12-14 18:27:29,171 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/sched_priv/holidays
2018-12-14 18:27:29,191 INFOCLI  c7-dev: /opt/pbs/bin/qmgr -c list sched default
2018-12-14 18:27:29,244 INFOCLI2 c7-dev: sudo -H /opt/pbs/sbin/pbsfs
2018-12-14 18:27:29,274 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/sched_priv/resource_group
2018-12-14 18:27:29,289 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/sched_priv/holidays
2018-12-14 18:27:29,310 INFO     ======================================
2018-12-14 18:27:29,310 INFO     Completed TestPbsExecjobEnd setUpClass
2018-12-14 18:27:29,310 INFO     ======================================
2018-12-14 18:27:29,311 INFO     test name: test_execjob_end_hook_order_and_reject (tests.functional.pbs_hook_execjob_end.TestPbsExecjobEnd)...
2018-12-14 18:27:29,311 INFO     test start time: Fri Dec 14 18:27:29 2018
2018-12-14 18:27:29,311 INFO     test docstring: 

        Test with mutiple execjob_end hooks with with
        different order for a job with one of the hooks rejecting the job.
        
2018-12-14 18:27:29,312 INFO     ================================
2018-12-14 18:27:29,312 INFO      Entered TestPbsExecjobEnd setUp
2018-12-14 18:27:29,312 INFO     ================================
2018-12-14 18:27:29,312 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Bf c7-dev
2018-12-14 18:27:29,346 INFO     status on c7-dev: server
2018-12-14 18:27:29,346 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Bf c7-dev
2018-12-14 18:27:29,381 INFO     manager on c7-dev: unset server managers
2018-12-14 18:27:29,381 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c unset server managers
2018-12-14 18:27:29,424 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Bf c7-dev
2018-12-14 18:27:29,455 INFO     expect on server c7-dev: managers unset  server c7-dev ...  OK
2018-12-14 18:27:29,455 INFO     manager on c7-dev: set server {'managers': (2, 'root@*')}
2018-12-14 18:27:29,455 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c set server managers+=root@*
2018-12-14 18:27:29,506 INFO     server c7-dev: reverting configuration to defaults
2018-12-14 18:27:29,506 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Bf c7-dev
2018-12-14 18:27:29,536 INFO     select on c7-dev: __ALL__
2018-12-14 18:27:29,536 INFOCLI  c7-dev: /opt/pbs/bin/qselect
2018-12-14 18:27:29,570 INFOCLI  c7-dev: /opt/pbs/bin/qstat -f @c7-dev
2018-12-14 18:27:29,605 INFO     expect on server c7-dev: job_state set 0 job ...  OK
2018-12-14 18:27:29,605 INFOCLI  c7-dev: /opt/pbs/bin/pbs_rstat -f
2018-12-14 18:27:29,649 INFO     manager on c7-dev: unset server ['max_job_sequence_id', 'pbs_license_max', 'pbs_license_min']
2018-12-14 18:27:29,649 INFOCLI  c7-dev: /opt/pbs/bin/qmgr -c unset server max_job_sequence_id,pbs_license_max,pbs_license_min
2018-12-14 18:27:29,688 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook
2018-12-14 18:27:29,736 INFO     manager on c7-dev: delete hook execjob_end_logmsg,exechost_periodic_logmsg
2018-12-14 18:27:29,736 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c delete hook execjob_end_logmsg,exechost_periodic_logmsg
2018-12-14 18:27:29,787 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook execjob_end_logmsg
2018-12-14 18:27:29,831 INFO     expect on server c7-dev:  unset  hook execjob_end_logmsg ...  OK
2018-12-14 18:27:29,832 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook exechost_periodic_logmsg
2018-12-14 18:27:29,882 INFO     expect on server c7-dev:  unset  hook exechost_periodic_logmsg ...  OK
2018-12-14 18:27:29,882 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Qf @c7-dev
2018-12-14 18:27:29,923 INFO     status on c7-dev: node
2018-12-14 18:27:29,923 INFOCLI  c7-dev: /opt/pbs/bin/pbsnodes -s c7-dev -v -a
2018-12-14 18:27:29,959 INFO     manager on c7-dev: delete queue workq
2018-12-14 18:27:29,960 INFOCLI  c7-dev: /opt/pbs/bin/qmgr -c delete queue workq
2018-12-14 18:27:29,993 INFO     server c7-dev: expect offset set to 0.5
2018-12-14 18:27:30,495 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Qf workq@c7-dev
2018-12-14 18:27:30,521 INFO     expect on server c7-dev:  unset  queue workq ...  OK
2018-12-14 18:27:30,522 INFO     manager on c7-dev: create queue workq {'started': 'True', 'queue_type': 'Execution', 'enabled': 'True'}
2018-12-14 18:27:30,522 INFOCLI  c7-dev: /opt/pbs/bin/qmgr -c create queue workq started=True,queue_type=Execution,enabled=True
2018-12-14 18:27:30,581 INFO     status on c7-dev: queue workq
2018-12-14 18:27:30,582 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Qf workq@c7-dev
2018-12-14 18:27:30,619 INFO     server c7-dev: expect offset set to 0.5
2018-12-14 18:27:31,120 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Qf workq@c7-dev
2018-12-14 18:27:31,166 INFO     expect on server c7-dev: started set True || queue_type set Execution || enabled set True queue workq ...  OK
2018-12-14 18:27:31,166 INFO     manager on c7-dev: list sched
2018-12-14 18:27:31,166 INFOCLI  c7-dev: /opt/pbs/bin/qmgr -c list sched
2018-12-14 18:27:31,220 INFOCLI2 c7-dev: sudo -H /opt/pbs/sbin/pbsfs
2018-12-14 18:27:31,252 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/sched_priv/resource_group
2018-12-14 18:27:31,274 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/sched_priv/holidays
2018-12-14 18:27:31,297 INFO     manager on c7-dev: set server {'default_queue': 'workq'}
2018-12-14 18:27:31,297 INFOCLI  c7-dev: /opt/pbs/bin/qmgr -c set server default_queue=workq
2018-12-14 18:27:31,335 INFO     status on c7-dev: resource
2018-12-14 18:27:31,336 INFO     manager on c7-dev: list resource
2018-12-14 18:27:31,336 INFOCLI  c7-dev: /opt/pbs/bin/qmgr -c list resource
2018-12-14 18:27:31,373 INFOCLI  status on c7-dev: server license_count
2018-12-14 18:27:31,373 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Bf c7-dev
2018-12-14 18:27:31,415 INFO     server: c7-dev licensed
2018-12-14 18:27:31,443 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/server_priv/comm.lock
2018-12-14 18:27:31,486 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/sched_priv/sched.lock
2018-12-14 18:27:31,509 INFO     scheduler c7-dev: reverting configuration to defaults
2018-12-14 18:27:31,509 INFO     manager on c7-dev: unset sched ['sched_priv', 'sched_cycle_length', 'scheduler_iteration', 'scheduling', 'sched_log']
2018-12-14 18:27:31,509 INFOCLI  c7-dev: /opt/pbs/bin/qmgr -c unset sched sched_priv,sched_cycle_length,scheduler_iteration,scheduling,sched_log
2018-12-14 18:27:31,552 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/sched_priv/dedicated_time
2018-12-14 18:27:31,576 INFOCLI2 c7-dev: sudo -H cmp /opt/pbs/etc/pbs_resource_group /var/spool/pbs/sched_priv/resource_group
2018-12-14 18:27:31,601 INFO     scheduler c7-dev: reverting holidays file to default
2018-12-14 18:27:31,601 INFOCLI2 c7-dev: sudo -H cmp /opt/pbs/etc/pbs_holidays /var/spool/pbs/sched_priv/holidays
2018-12-14 18:27:31,621 INFOCLI2 c7-dev: sudo -H cmp /opt/pbs/etc/pbs_sched_config /var/spool/pbs/sched_priv/sched_config
2018-12-14 18:27:31,636 INFO     scheduler c7-dev: sent signal -HUP
2018-12-14 18:27:31,637 INFOCLI2 c7-dev: sudo -H kill -HUP 39737
2018-12-14 18:27:31,659 INFOCLI2 c7-dev: sudo -H /opt/pbs/sbin/pbsfs -e -I default
2018-12-14 18:27:31,739 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/sched_priv/sched.lock
2018-12-14 18:27:31,787 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/mom_priv/mom.lock
2018-12-14 18:27:31,805 INFOCLI2 c7-dev: sudo -H /opt/pbs/sbin/pbs_mom --version
2018-12-14 18:27:31,843 INFO     mom c7-dev: reverting configuration to defaults
2018-12-14 18:27:31,843 INFOCLI2 c7-dev: which rm
2018-12-14 18:27:31,849 INFOCLI2 c7-dev: sudo -H /bin/rm -f /var/spool/pbs/mom_priv/epilogue
2018-12-14 18:27:31,865 INFOCLI2 c7-dev: sudo -H /bin/rm -f /var/spool/pbs/mom_priv/prologue
2018-12-14 18:27:31,883 INFOCLI  c7-dev: sudo -H /opt/pbs/sbin/pbs_mom -s list
2018-12-14 18:27:31,938 INFOCLI2 c7-dev: which cp
2018-12-14 18:27:31,943 INFOCLI2 c7-dev: sudo -H /bin/cp /tmp/PtlPbsmMtAdw /var/spool/pbs/mom_priv/config
2018-12-14 18:27:31,977 INFO     mom c7-dev: sent signal -HUP
2018-12-14 18:27:31,977 INFOCLI2 c7-dev: sudo -H kill -HUP 39724
2018-12-14 18:27:32,019 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/mom_priv/mom.lock
2018-12-14 18:27:32,043 INFOCLI  c7-dev: /opt/pbs/bin/pbsnodes -s c7-dev -v -a
2018-12-14 18:27:32,074 INFO     status on c7-dev: node c7-dev
2018-12-14 18:27:32,075 INFOCLI  c7-dev: /opt/pbs/bin/pbsnodes -s c7-dev -v c7-dev
2018-12-14 18:27:32,106 INFOCLI  c7-dev: /opt/pbs/bin/pbsnodes -s c7-dev -v c7-dev
2018-12-14 18:27:32,142 INFO     expect on server c7-dev: state = free node c7-dev ...  OK
2018-12-14 18:27:32,142 INFO     =================================
2018-12-14 18:27:32,142 INFO     Completed TestPbsExecjobEnd setUp
2018-12-14 18:27:32,143 INFO     =================================
2018-12-14 18:27:32,143 INFO     status on c7-dev: hook
2018-12-14 18:27:32,143 INFO     manager on c7-dev: list hook
2018-12-14 18:27:32,143 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook
2018-12-14 18:27:32,191 INFO     status on c7-dev: hook
2018-12-14 18:27:32,192 INFO     manager on c7-dev: list hook
2018-12-14 18:27:32,192 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook
2018-12-14 18:27:32,249 INFO     manager on c7-dev: create hook execjob_end_logmsg1
2018-12-14 18:27:32,249 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c create hook execjob_end_logmsg1
2018-12-14 18:27:32,299 INFO     status on c7-dev: hook execjob_end_logmsg1
2018-12-14 18:27:32,299 INFO     manager on c7-dev: list hook execjob_end_logmsg1
2018-12-14 18:27:32,300 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook execjob_end_logmsg1
2018-12-14 18:27:32,350 INFO     manager on c7-dev: set hook execjob_end_logmsg1 {'enabled': 'True', 'event': 'execjob_end', 'order': '1'}
2018-12-14 18:27:32,351 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c set hook execjob_end_logmsg1 enabled=True,event=execjob_end,order=1
2018-12-14 18:27:32,401 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook execjob_end_logmsg1
2018-12-14 18:27:32,447 INFO     expect on server c7-dev: enabled set True || event set execjob_end || order set 1 hook execjob_end_logmsg1 ...  OK
2018-12-14 18:27:32,447 INFO     manager on c7-dev: import hook execjob_end_logmsg1 {'content-type': 'application/x-python', 'input-file': '/tmp/PtlPbsGer8Ka', 'content-encoding': 'default'}
2018-12-14 18:27:32,447 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c import hook execjob_end_logmsg1 application/x-python default /tmp/PtlPbsGer8Ka
2018-12-14 18:27:32,494 INFO     server c7-dev: imported hook body
---
import pbs
e = pbs.event()
pbs.logjobmsg(e.job.id,                                   'executed %s hook' % e.hook_name)
e.accept()
---
2018-12-14 18:27:32,495 INFO     status on c7-dev: hook
2018-12-14 18:27:32,495 INFO     manager on c7-dev: list hook
2018-12-14 18:27:32,495 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook
2018-12-14 18:27:32,542 INFO     status on c7-dev: hook
2018-12-14 18:27:32,542 INFO     manager on c7-dev: list hook
2018-12-14 18:27:32,543 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook
2018-12-14 18:27:32,591 INFO     manager on c7-dev: create hook execjob_end_logmsg2
2018-12-14 18:27:32,591 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c create hook execjob_end_logmsg2
2018-12-14 18:27:32,637 INFO     status on c7-dev: hook execjob_end_logmsg2
2018-12-14 18:27:32,637 INFO     manager on c7-dev: list hook execjob_end_logmsg2
2018-12-14 18:27:32,637 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook execjob_end_logmsg2
2018-12-14 18:27:32,686 INFO     manager on c7-dev: set hook execjob_end_logmsg2 {'enabled': 'True', 'event': 'execjob_end', 'order': '2'}
2018-12-14 18:27:32,686 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c set hook execjob_end_logmsg2 enabled=True,event=execjob_end,order=2
2018-12-14 18:27:32,737 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook execjob_end_logmsg2
2018-12-14 18:27:32,785 INFO     expect on server c7-dev: enabled set True || event set execjob_end || order set 2 hook execjob_end_logmsg2 ...  OK
2018-12-14 18:27:32,786 INFO     manager on c7-dev: import hook execjob_end_logmsg2 {'content-type': 'application/x-python', 'input-file': '/tmp/PtlPbsPtmn_T', 'content-encoding': 'default'}
2018-12-14 18:27:32,786 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c import hook execjob_end_logmsg2 application/x-python default /tmp/PtlPbsPtmn_T
2018-12-14 18:27:32,839 INFO     server c7-dev: imported hook body
---
import pbs
e = pbs.event()
pbs.logjobmsg(e.job.id, 'executed execjob_end hook')
e.reject('Job is rejected')
---
2018-12-14 18:27:32,839 INFO     status on c7-dev: hook
2018-12-14 18:27:32,839 INFO     manager on c7-dev: list hook
2018-12-14 18:27:32,840 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook
2018-12-14 18:27:32,885 INFO     status on c7-dev: hook
2018-12-14 18:27:32,886 INFO     manager on c7-dev: list hook
2018-12-14 18:27:32,886 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook
2018-12-14 18:27:32,935 INFO     manager on c7-dev: create hook execjob_end_logmsg3
2018-12-14 18:27:32,935 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c create hook execjob_end_logmsg3
2018-12-14 18:27:32,991 INFO     status on c7-dev: hook execjob_end_logmsg3
2018-12-14 18:27:32,992 INFO     manager on c7-dev: list hook execjob_end_logmsg3
2018-12-14 18:27:32,992 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook execjob_end_logmsg3
2018-12-14 18:27:33,037 INFO     manager on c7-dev: set hook execjob_end_logmsg3 {'enabled': 'True', 'event': 'execjob_end', 'order': '170'}
2018-12-14 18:27:33,037 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c set hook execjob_end_logmsg3 enabled=True,event=execjob_end,order=170
2018-12-14 18:27:33,088 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook execjob_end_logmsg3
2018-12-14 18:27:33,135 INFO     expect on server c7-dev: enabled set True || event set execjob_end || order set 170 hook execjob_end_logmsg3 ...  OK
2018-12-14 18:27:33,136 INFO     manager on c7-dev: import hook execjob_end_logmsg3 {'content-type': 'application/x-python', 'input-file': '/tmp/PtlPbsgMgkh3', 'content-encoding': 'default'}
2018-12-14 18:27:33,136 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c import hook execjob_end_logmsg3 application/x-python default /tmp/PtlPbsgMgkh3
2018-12-14 18:27:33,188 INFO     server c7-dev: imported hook body
---
import pbs
e = pbs.event()
pbs.logjobmsg(e.job.id,                                   'executed %s hook' % e.hook_name)
e.accept()
---
2018-12-14 18:27:33,188 INFO     job: executable set to /bin/sleep with arguments: 100
2018-12-14 18:27:33,188 INFO     job: executable set to /bin/sleep with arguments: 1
2018-12-14 18:27:33,189 INFOCLI  c7-dev: sudo -H -u pbsuser /opt/pbs/bin/qsub -l select=ncpus=1 -- /bin/sleep 1
2018-12-14 18:27:33,264 INFO     submit to c7-dev as pbsuser: job 3072.c7-dev OrderedDict([('Resource_List.select', 'ncpus=1')])
2018-12-14 18:27:33,268 INFO     mom c7-dev log match: searching for "Job;3072.c7-dev;executed execjob_end_logmsg1 hook" - No match
2018-12-14 18:27:35,398 INFO     mom c7-dev log match: searching for "Job;3072.c7-dev;executed execjob_end_logmsg1 hook"... OK
2018-12-14 18:27:35,400 INFO     mom c7-dev log match: searching for "Job;3072.c7-dev;Job is rejected" - No match
2018-12-14 18:27:37,504 INFO     mom c7-dev log match: searching for "Job;3072.c7-dev;Job is rejected"... OK
2018-12-14 18:27:37,506 INFO     mom c7-dev log match: searching for "Job;3072.c7-dev;executed execjob_end_logmsg3 hook" - No match
2018-12-14 18:27:39,626 INFO     mom c7-dev log match: searching for "Job;3072.c7-dev;executed execjob_end_logmsg3 hook" - attempt 2
2018-12-14 18:27:41,730 INFO     mom c7-dev log match: searching for "Job;3072.c7-dev;executed execjob_end_logmsg3 hook" - attempt 3
2018-12-14 18:27:43,842 INFO     mom c7-dev log match: searching for "Job;3072.c7-dev;executed execjob_end_logmsg3 hook" - attempt 4
2018-12-14 18:27:45,969 INFO     mom c7-dev log match: searching for "Job;3072.c7-dev;executed execjob_end_logmsg3 hook" - attempt 5
2018-12-14 18:27:48,083 INFO     mom c7-dev log match: searching for "Job;3072.c7-dev;executed execjob_end_logmsg3 hook" - attempt 6
2018-12-14 18:27:50,194 INFO     mom c7-dev log match: searching for "Job;3072.c7-dev;executed execjob_end_logmsg3 hook" - attempt 7
2018-12-14 18:27:52,313 INFO     mom c7-dev log match: searching for "Job;3072.c7-dev;executed execjob_end_logmsg3 hook" - attempt 8
2018-12-14 18:27:54,424 INFO     mom c7-dev log match: searching for "Job;3072.c7-dev;executed execjob_end_logmsg3 hook" - attempt 9
2018-12-14 18:27:56,537 INFO     mom c7-dev log match: searching for "Job;3072.c7-dev;executed execjob_end_logmsg3 hook" - attempt 10
2018-12-14 18:27:58,540 INFO     ===================================
2018-12-14 18:27:58,541 INFO      Entered TestPbsExecjobEnd tearDown
2018-12-14 18:27:58,541 INFO     ===================================
2018-12-14 18:27:58,541 INFO     ====================================
2018-12-14 18:27:58,541 INFO     Completed TestPbsExecjobEnd tearDown
2018-12-14 18:27:58,541 INFO     ====================================
2018-12-14 18:27:58,543 INFO     ok

2018-12-14 18:27:58,543 INFO     test name: test_execjob_end_multi_job (tests.functional.pbs_hook_execjob_end.TestPbsExecjobEnd)...
2018-12-14 18:27:58,543 INFO     test start time: Fri Dec 14 18:27:58 2018
2018-12-14 18:27:58,544 INFO     test docstring: 

        Test a execjob_end hook for non-blocking of mom with mutiple jobs
        
2018-12-14 18:27:58,544 INFO     ================================
2018-12-14 18:27:58,544 INFO      Entered TestPbsExecjobEnd setUp
2018-12-14 18:27:58,544 INFO     ================================
2018-12-14 18:27:58,545 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Bf c7-dev
2018-12-14 18:27:58,575 INFO     status on c7-dev: server
2018-12-14 18:27:58,576 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Bf c7-dev
2018-12-14 18:27:58,604 INFO     manager on c7-dev: unset server managers
2018-12-14 18:27:58,605 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c unset server managers
2018-12-14 18:27:58,648 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Bf c7-dev
2018-12-14 18:27:58,669 INFO     expect on server c7-dev: managers unset  server c7-dev ...  OK
2018-12-14 18:27:58,669 INFO     manager on c7-dev: set server {'managers': (2, 'root@*')}
2018-12-14 18:27:58,669 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c set server managers+=root@*
2018-12-14 18:27:58,706 INFO     server c7-dev: reverting configuration to defaults
2018-12-14 18:27:58,706 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Bf c7-dev
2018-12-14 18:27:58,728 INFO     select on c7-dev: __ALL__
2018-12-14 18:27:58,728 INFOCLI  c7-dev: /opt/pbs/bin/qselect
2018-12-14 18:27:58,758 INFOCLI  c7-dev: /opt/pbs/bin/qstat -f @c7-dev
2018-12-14 18:27:58,789 INFO     expect on server c7-dev: job_state set 0 job ...  OK
2018-12-14 18:27:58,789 INFOCLI  c7-dev: /opt/pbs/bin/pbs_rstat -f
2018-12-14 18:27:58,821 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook
2018-12-14 18:27:58,862 INFO     manager on c7-dev: delete hook execjob_end_logmsg3,execjob_end_logmsg2,execjob_end_logmsg1
2018-12-14 18:27:58,862 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c delete hook execjob_end_logmsg3,execjob_end_logmsg2,execjob_end_logmsg1
2018-12-14 18:27:58,919 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook execjob_end_logmsg3
2018-12-14 18:27:58,970 INFO     expect on server c7-dev:  unset  hook execjob_end_logmsg3 ...  OK
2018-12-14 18:27:58,970 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook execjob_end_logmsg2
2018-12-14 18:27:59,015 INFO     expect on server c7-dev:  unset  hook execjob_end_logmsg2 ...  OK
2018-12-14 18:27:59,015 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook execjob_end_logmsg1
2018-12-14 18:27:59,061 INFO     expect on server c7-dev:  unset  hook execjob_end_logmsg1 ...  OK
2018-12-14 18:27:59,062 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Qf @c7-dev
2018-12-14 18:27:59,088 INFO     status on c7-dev: node
2018-12-14 18:27:59,088 INFOCLI  c7-dev: /opt/pbs/bin/pbsnodes -s c7-dev -v -a
2018-12-14 18:27:59,111 INFO     manager on c7-dev: delete queue workq
2018-12-14 18:27:59,111 INFOCLI  c7-dev: /opt/pbs/bin/qmgr -c delete queue workq
2018-12-14 18:27:59,149 INFO     server c7-dev: expect offset set to 0.5
2018-12-14 18:27:59,651 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Qf workq@c7-dev
2018-12-14 18:27:59,691 INFO     expect on server c7-dev:  unset  queue workq ...  OK
2018-12-14 18:27:59,691 INFO     manager on c7-dev: create queue workq {'started': 'True', 'queue_type': 'Execution', 'enabled': 'True'}
2018-12-14 18:27:59,691 INFOCLI  c7-dev: /opt/pbs/bin/qmgr -c create queue workq started=True,queue_type=Execution,enabled=True
2018-12-14 18:27:59,722 INFO     status on c7-dev: queue workq
2018-12-14 18:27:59,722 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Qf workq@c7-dev
2018-12-14 18:27:59,744 INFO     server c7-dev: expect offset set to 0.5
2018-12-14 18:28:00,246 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Qf workq@c7-dev
2018-12-14 18:28:00,272 INFO     expect on server c7-dev: started set True || queue_type set Execution || enabled set True queue workq ...  OK
2018-12-14 18:28:00,272 INFO     manager on c7-dev: list sched
2018-12-14 18:28:00,273 INFOCLI  c7-dev: /opt/pbs/bin/qmgr -c list sched
2018-12-14 18:28:00,322 INFOCLI2 c7-dev: sudo -H /opt/pbs/sbin/pbsfs
2018-12-14 18:28:00,355 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/sched_priv/resource_group
2018-12-14 18:28:00,379 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/sched_priv/holidays
2018-12-14 18:28:00,406 INFO     manager on c7-dev: set server {'default_queue': 'workq'}
2018-12-14 18:28:00,406 INFOCLI  c7-dev: /opt/pbs/bin/qmgr -c set server default_queue=workq
2018-12-14 18:28:00,435 INFO     status on c7-dev: resource
2018-12-14 18:28:00,435 INFO     manager on c7-dev: list resource
2018-12-14 18:28:00,436 INFOCLI  c7-dev: /opt/pbs/bin/qmgr -c list resource
2018-12-14 18:28:00,462 INFOCLI  status on c7-dev: server license_count
2018-12-14 18:28:00,463 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Bf c7-dev
2018-12-14 18:28:00,490 INFO     server: c7-dev licensed
2018-12-14 18:28:00,518 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/server_priv/comm.lock
2018-12-14 18:28:00,558 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/sched_priv/sched.lock
2018-12-14 18:28:00,576 INFO     scheduler c7-dev: reverting configuration to defaults
2018-12-14 18:28:00,576 INFO     manager on c7-dev: unset sched ['sched_priv', 'sched_cycle_length', 'scheduler_iteration', 'scheduling', 'sched_log']
2018-12-14 18:28:00,576 INFOCLI  c7-dev: /opt/pbs/bin/qmgr -c unset sched sched_priv,sched_cycle_length,scheduler_iteration,scheduling,sched_log
2018-12-14 18:28:00,610 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/sched_priv/dedicated_time
2018-12-14 18:28:00,628 INFOCLI2 c7-dev: sudo -H cmp /opt/pbs/etc/pbs_resource_group /var/spool/pbs/sched_priv/resource_group
2018-12-14 18:28:00,649 INFO     scheduler c7-dev: reverting holidays file to default
2018-12-14 18:28:00,649 INFOCLI2 c7-dev: sudo -H cmp /opt/pbs/etc/pbs_holidays /var/spool/pbs/sched_priv/holidays
2018-12-14 18:28:00,668 INFOCLI2 c7-dev: sudo -H cmp /opt/pbs/etc/pbs_sched_config /var/spool/pbs/sched_priv/sched_config
2018-12-14 18:28:00,686 INFO     scheduler c7-dev: sent signal -HUP
2018-12-14 18:28:00,686 INFOCLI2 c7-dev: sudo -H kill -HUP 39737
2018-12-14 18:28:00,702 INFOCLI2 c7-dev: sudo -H /opt/pbs/sbin/pbsfs -e -I default
2018-12-14 18:28:00,773 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/sched_priv/sched.lock
2018-12-14 18:28:00,808 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/mom_priv/mom.lock
2018-12-14 18:28:00,824 INFO     mom c7-dev: reverting configuration to defaults
2018-12-14 18:28:00,824 INFOCLI2 c7-dev: sudo -H /bin/rm -f /var/spool/pbs/mom_priv/epilogue
2018-12-14 18:28:00,844 INFOCLI2 c7-dev: sudo -H /bin/rm -f /var/spool/pbs/mom_priv/prologue
2018-12-14 18:28:00,866 INFOCLI  c7-dev: sudo -H /opt/pbs/sbin/pbs_mom -s list
2018-12-14 18:28:00,915 INFO     mom c7-dev: sent signal -HUP
2018-12-14 18:28:00,915 INFOCLI2 c7-dev: sudo -H kill -HUP 39724
2018-12-14 18:28:00,953 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/mom_priv/mom.lock
2018-12-14 18:28:00,978 INFOCLI  c7-dev: /opt/pbs/bin/pbsnodes -s c7-dev -v -a
2018-12-14 18:28:01,006 INFO     status on c7-dev: node c7-dev
2018-12-14 18:28:01,006 INFOCLI  c7-dev: /opt/pbs/bin/pbsnodes -s c7-dev -v c7-dev
2018-12-14 18:28:01,036 INFOCLI  c7-dev: /opt/pbs/bin/pbsnodes -s c7-dev -v c7-dev
2018-12-14 18:28:01,062 INFO     expect on server c7-dev: state = free node c7-dev ...  OK
2018-12-14 18:28:01,063 INFO     =================================
2018-12-14 18:28:01,063 INFO     Completed TestPbsExecjobEnd setUp
2018-12-14 18:28:01,063 INFO     =================================
2018-12-14 18:28:01,064 INFO     status on c7-dev: hook
2018-12-14 18:28:01,064 INFO     manager on c7-dev: list hook
2018-12-14 18:28:01,064 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook
2018-12-14 18:28:01,105 INFO     status on c7-dev: hook
2018-12-14 18:28:01,105 INFO     manager on c7-dev: list hook
2018-12-14 18:28:01,106 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook
2018-12-14 18:28:01,140 INFO     manager on c7-dev: create hook execjob_end_logmsg4
2018-12-14 18:28:01,141 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c create hook execjob_end_logmsg4
2018-12-14 18:28:01,184 INFO     status on c7-dev: hook execjob_end_logmsg4
2018-12-14 18:28:01,184 INFO     manager on c7-dev: list hook execjob_end_logmsg4
2018-12-14 18:28:01,184 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook execjob_end_logmsg4
2018-12-14 18:28:01,225 INFO     manager on c7-dev: set hook execjob_end_logmsg4 {'alarm': '50', 'enabled': 'True', 'event': 'execjob_end'}
2018-12-14 18:28:01,225 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c set hook execjob_end_logmsg4 alarm=50,enabled=True,event=execjob_end
2018-12-14 18:28:01,285 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook execjob_end_logmsg4
2018-12-14 18:28:01,327 INFO     expect on server c7-dev: alarm set 50 || enabled set True || event set execjob_end hook execjob_end_logmsg4 ...  OK
2018-12-14 18:28:01,327 INFO     manager on c7-dev: import hook execjob_end_logmsg4 {'content-type': 'application/x-python', 'input-file': '/tmp/PtlPbsmiaiu7', 'content-encoding': 'default'}
2018-12-14 18:28:01,327 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c import hook execjob_end_logmsg4 application/x-python default /tmp/PtlPbsmiaiu7
2018-12-14 18:28:01,372 INFO     server c7-dev: imported hook body
---
import pbs
import time
e = pbs.event()
pbs.logjobmsg(e.job.id,                                          'executed execjob_end hook')
time.sleep(10)
pbs.logjobmsg(e.job.id,                                          'execjob_end hook ended')
e.accept()
---
2018-12-14 18:28:01,372 INFO     job: executable set to /bin/sleep with arguments: 100
2018-12-14 18:28:01,373 INFO     job: executable set to /bin/sleep with arguments: 1
2018-12-14 18:28:01,373 INFOCLI  c7-dev: sudo -H -u pbsuser /opt/pbs/bin/qsub -l select=ncpus=1 -- /bin/sleep 1
2018-12-14 18:28:01,406 INFO     submit to c7-dev as pbsuser: job 3073.c7-dev OrderedDict([('Resource_List.select', 'ncpus=1')])
2018-12-14 18:28:01,407 INFO     job: executable set to /bin/sleep with arguments: 1
2018-12-14 18:28:01,407 INFOCLI  c7-dev: sudo -H -u pbsuser /opt/pbs/bin/qsub -l select=ncpus=1 -- /bin/sleep 1
2018-12-14 18:28:01,436 INFO     submit to c7-dev as pbsuser: job 3074.c7-dev OrderedDict([('Resource_List.select', 'ncpus=1')])
2018-12-14 18:28:01,438 INFO     mom c7-dev log match: searching for "Job;3073.c7-dev;executed execjob_end hook" - No match
2018-12-14 18:28:03,545 INFO     mom c7-dev log match: searching for "Job;3073.c7-dev;executed execjob_end hook"... OK
2018-12-14 18:28:03,546 INFO     mom c7-dev log match: searching for "Job;3074.c7-dev;executed execjob_end hook"... OK
2018-12-14 18:28:03,548 INFO     mom c7-dev log match: searching for "Job;3073.c7-dev;execjob_end hook ended" - No match
2018-12-14 18:28:05,665 INFO     mom c7-dev log match: searching for "Job;3073.c7-dev;execjob_end hook ended" - attempt 2
2018-12-14 18:28:07,786 INFO     mom c7-dev log match: searching for "Job;3073.c7-dev;execjob_end hook ended" - attempt 3
2018-12-14 18:28:09,902 INFO     mom c7-dev log match: searching for "Job;3073.c7-dev;execjob_end hook ended" - attempt 4
2018-12-14 18:28:12,026 INFO     mom c7-dev log match: searching for "Job;3073.c7-dev;execjob_end hook ended" - attempt 5
2018-12-14 18:28:14,139 INFO     mom c7-dev log match: searching for "Job;3073.c7-dev;execjob_end hook ended"... OK
2018-12-14 18:28:14,140 INFO     mom c7-dev log match: searching for "Job;3074.c7-dev;execjob_end hook ended"... OK
2018-12-14 18:28:14,140 INFO     ===================================
2018-12-14 18:28:14,140 INFO      Entered TestPbsExecjobEnd tearDown
2018-12-14 18:28:14,140 INFO     ===================================
2018-12-14 18:28:14,140 INFO     ====================================
2018-12-14 18:28:14,140 INFO     Completed TestPbsExecjobEnd tearDown
2018-12-14 18:28:14,140 INFO     ====================================
2018-12-14 18:28:14,140 INFO     ok

2018-12-14 18:28:14,141 INFO     test name: test_execjob_end_non_blocking (tests.functional.pbs_hook_execjob_end.TestPbsExecjobEnd)...
2018-12-14 18:28:14,141 INFO     test start time: Fri Dec 14 18:28:14 2018
2018-12-14 18:28:14,141 INFO     test docstring: 

        Test to make sure pbs_mom is not blocked upon
        execution of an execjob_end hook.
        
2018-12-14 18:28:14,141 INFO     ================================
2018-12-14 18:28:14,141 INFO      Entered TestPbsExecjobEnd setUp
2018-12-14 18:28:14,141 INFO     ================================
2018-12-14 18:28:14,141 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Bf c7-dev
2018-12-14 18:28:14,171 INFO     status on c7-dev: server
2018-12-14 18:28:14,171 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Bf c7-dev
2018-12-14 18:28:14,199 INFO     manager on c7-dev: unset server managers
2018-12-14 18:28:14,199 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c unset server managers
2018-12-14 18:28:14,251 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Bf c7-dev
2018-12-14 18:28:14,276 INFO     expect on server c7-dev: managers unset  server c7-dev ...  OK
2018-12-14 18:28:14,276 INFO     manager on c7-dev: set server {'managers': (2, 'root@*')}
2018-12-14 18:28:14,276 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c set server managers+=root@*
2018-12-14 18:28:14,319 INFO     server c7-dev: reverting configuration to defaults
2018-12-14 18:28:14,319 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Bf c7-dev
2018-12-14 18:28:14,348 INFO     select on c7-dev: __ALL__
2018-12-14 18:28:14,349 INFOCLI  c7-dev: /opt/pbs/bin/qselect
2018-12-14 18:28:14,383 INFOCLI  c7-dev: /opt/pbs/bin/qstat -f @c7-dev
2018-12-14 18:28:14,409 INFO     expect on server c7-dev: job_state set 0 job ...  OK
2018-12-14 18:28:14,410 INFOCLI  c7-dev: /opt/pbs/bin/pbs_rstat -f
2018-12-14 18:28:14,450 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook
2018-12-14 18:28:14,497 INFO     manager on c7-dev: delete hook execjob_end_logmsg4
2018-12-14 18:28:14,497 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c delete hook execjob_end_logmsg4
2018-12-14 18:28:14,544 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook execjob_end_logmsg4
2018-12-14 18:28:14,585 INFO     expect on server c7-dev:  unset  hook execjob_end_logmsg4 ...  OK
2018-12-14 18:28:14,585 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Qf @c7-dev
2018-12-14 18:28:14,611 INFO     status on c7-dev: node
2018-12-14 18:28:14,611 INFOCLI  c7-dev: /opt/pbs/bin/pbsnodes -s c7-dev -v -a
2018-12-14 18:28:14,639 INFO     manager on c7-dev: delete queue workq
2018-12-14 18:28:14,640 INFOCLI  c7-dev: /opt/pbs/bin/qmgr -c delete queue workq
2018-12-14 18:28:14,669 INFO     server c7-dev: expect offset set to 0.5
2018-12-14 18:28:15,171 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Qf workq@c7-dev
2018-12-14 18:28:15,208 INFO     expect on server c7-dev:  unset  queue workq ...  OK
2018-12-14 18:28:15,209 INFO     manager on c7-dev: create queue workq {'started': 'True', 'queue_type': 'Execution', 'enabled': 'True'}
2018-12-14 18:28:15,209 INFOCLI  c7-dev: /opt/pbs/bin/qmgr -c create queue workq started=True,queue_type=Execution,enabled=True
2018-12-14 18:28:15,250 INFO     status on c7-dev: queue workq
2018-12-14 18:28:15,251 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Qf workq@c7-dev
2018-12-14 18:28:15,307 INFO     server c7-dev: expect offset set to 0.5
2018-12-14 18:28:15,809 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Qf workq@c7-dev
2018-12-14 18:28:15,852 INFO     expect on server c7-dev: started set True || queue_type set Execution || enabled set True queue workq ...  OK
2018-12-14 18:28:15,852 INFO     manager on c7-dev: list sched
2018-12-14 18:28:15,852 INFOCLI  c7-dev: /opt/pbs/bin/qmgr -c list sched
2018-12-14 18:28:15,894 INFOCLI2 c7-dev: sudo -H /opt/pbs/sbin/pbsfs
2018-12-14 18:28:15,927 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/sched_priv/resource_group
2018-12-14 18:28:15,950 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/sched_priv/holidays
2018-12-14 18:28:15,968 INFO     manager on c7-dev: set server {'default_queue': 'workq'}
2018-12-14 18:28:15,968 INFOCLI  c7-dev: /opt/pbs/bin/qmgr -c set server default_queue=workq
2018-12-14 18:28:16,002 INFO     status on c7-dev: resource
2018-12-14 18:28:16,002 INFO     manager on c7-dev: list resource
2018-12-14 18:28:16,002 INFOCLI  c7-dev: /opt/pbs/bin/qmgr -c list resource
2018-12-14 18:28:16,035 INFOCLI  status on c7-dev: server license_count
2018-12-14 18:28:16,036 INFOCLI  c7-dev: /opt/pbs/bin/qstat -Bf c7-dev
2018-12-14 18:28:16,066 INFO     server: c7-dev licensed
2018-12-14 18:28:16,091 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/server_priv/comm.lock
2018-12-14 18:28:16,134 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/sched_priv/sched.lock
2018-12-14 18:28:16,151 INFO     scheduler c7-dev: reverting configuration to defaults
2018-12-14 18:28:16,151 INFO     manager on c7-dev: unset sched ['sched_priv', 'sched_cycle_length', 'scheduler_iteration', 'scheduling', 'sched_log']
2018-12-14 18:28:16,151 INFOCLI  c7-dev: /opt/pbs/bin/qmgr -c unset sched sched_priv,sched_cycle_length,scheduler_iteration,scheduling,sched_log
2018-12-14 18:28:16,186 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/sched_priv/dedicated_time
2018-12-14 18:28:16,208 INFOCLI2 c7-dev: sudo -H cmp /opt/pbs/etc/pbs_resource_group /var/spool/pbs/sched_priv/resource_group
2018-12-14 18:28:16,226 INFO     scheduler c7-dev: reverting holidays file to default
2018-12-14 18:28:16,227 INFOCLI2 c7-dev: sudo -H cmp /opt/pbs/etc/pbs_holidays /var/spool/pbs/sched_priv/holidays
2018-12-14 18:28:16,243 INFOCLI2 c7-dev: sudo -H cmp /opt/pbs/etc/pbs_sched_config /var/spool/pbs/sched_priv/sched_config
2018-12-14 18:28:16,259 INFO     scheduler c7-dev: sent signal -HUP
2018-12-14 18:28:16,259 INFOCLI2 c7-dev: sudo -H kill -HUP 39737
2018-12-14 18:28:16,275 INFOCLI2 c7-dev: sudo -H /opt/pbs/sbin/pbsfs -e -I default
2018-12-14 18:28:16,350 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/sched_priv/sched.lock
2018-12-14 18:28:16,385 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/mom_priv/mom.lock
2018-12-14 18:28:16,401 INFO     mom c7-dev: reverting configuration to defaults
2018-12-14 18:28:16,401 INFOCLI2 c7-dev: sudo -H /bin/rm -f /var/spool/pbs/mom_priv/epilogue
2018-12-14 18:28:16,415 INFOCLI2 c7-dev: sudo -H /bin/rm -f /var/spool/pbs/mom_priv/prologue
2018-12-14 18:28:16,431 INFOCLI  c7-dev: sudo -H /opt/pbs/sbin/pbs_mom -s list
2018-12-14 18:28:16,482 INFO     mom c7-dev: sent signal -HUP
2018-12-14 18:28:16,483 INFOCLI2 c7-dev: sudo -H kill -HUP 39724
2018-12-14 18:28:16,527 INFOCLI2 c7-dev: sudo -H /bin/cat /var/spool/pbs/mom_priv/mom.lock
2018-12-14 18:28:16,543 INFOCLI  c7-dev: /opt/pbs/bin/pbsnodes -s c7-dev -v -a
2018-12-14 18:28:16,572 INFO     status on c7-dev: node c7-dev
2018-12-14 18:28:16,573 INFOCLI  c7-dev: /opt/pbs/bin/pbsnodes -s c7-dev -v c7-dev
2018-12-14 18:28:16,597 INFOCLI  c7-dev: /opt/pbs/bin/pbsnodes -s c7-dev -v c7-dev
2018-12-14 18:28:16,626 INFO     expect on server c7-dev: state = free node c7-dev ...  OK
2018-12-14 18:28:16,626 INFO     =================================
2018-12-14 18:28:16,626 INFO     Completed TestPbsExecjobEnd setUp
2018-12-14 18:28:16,626 INFO     =================================
2018-12-14 18:28:16,626 INFO     status on c7-dev: hook
2018-12-14 18:28:16,626 INFO     manager on c7-dev: list hook
2018-12-14 18:28:16,626 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook
2018-12-14 18:28:16,667 INFO     status on c7-dev: hook
2018-12-14 18:28:16,668 INFO     manager on c7-dev: list hook
2018-12-14 18:28:16,668 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook
2018-12-14 18:28:16,709 INFO     manager on c7-dev: create hook execjob_end_logmsg
2018-12-14 18:28:16,709 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c create hook execjob_end_logmsg
2018-12-14 18:28:16,750 INFO     status on c7-dev: hook execjob_end_logmsg
2018-12-14 18:28:16,750 INFO     manager on c7-dev: list hook execjob_end_logmsg
2018-12-14 18:28:16,750 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook execjob_end_logmsg
2018-12-14 18:28:16,789 INFO     manager on c7-dev: set hook execjob_end_logmsg {'alarm': '50', 'enabled': 'True', 'event': 'execjob_end'}
2018-12-14 18:28:16,789 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c set hook execjob_end_logmsg alarm=50,enabled=True,event=execjob_end
2018-12-14 18:28:16,838 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook execjob_end_logmsg
2018-12-14 18:28:16,878 INFO     expect on server c7-dev: alarm set 50 || enabled set True || event set execjob_end hook execjob_end_logmsg ...  OK
2018-12-14 18:28:16,880 INFO     manager on c7-dev: import hook execjob_end_logmsg {'content-type': 'application/x-python', 'input-file': '/tmp/PtlPbse4tNan', 'content-encoding': 'default'}
2018-12-14 18:28:16,880 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c import hook execjob_end_logmsg application/x-python default /tmp/PtlPbse4tNan
2018-12-14 18:28:16,920 INFO     server c7-dev: imported hook body
---
import pbs
import time
e = pbs.event()
pbs.logjobmsg(e.job.id,                                          'executed execjob_end hook')
time.sleep(10)
pbs.logjobmsg(e.job.id,                                          'execjob_end hook ended')
e.accept()
---
2018-12-14 18:28:16,920 INFO     job: executable set to /bin/sleep with arguments: 100
2018-12-14 18:28:16,920 INFO     job: executable set to /bin/sleep with arguments: 1
2018-12-14 18:28:16,921 INFO     status on c7-dev: hook
2018-12-14 18:28:16,921 INFO     manager on c7-dev: list hook
2018-12-14 18:28:16,921 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook
2018-12-14 18:28:16,956 INFO     status on c7-dev: hook
2018-12-14 18:28:16,956 INFO     manager on c7-dev: list hook
2018-12-14 18:28:16,957 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook
2018-12-14 18:28:17,004 INFO     manager on c7-dev: create hook exechost_periodic_logmsg
2018-12-14 18:28:17,005 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c create hook exechost_periodic_logmsg
2018-12-14 18:28:17,041 INFO     status on c7-dev: hook exechost_periodic_logmsg
2018-12-14 18:28:17,042 INFO     manager on c7-dev: list hook exechost_periodic_logmsg
2018-12-14 18:28:17,042 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook exechost_periodic_logmsg
2018-12-14 18:28:17,086 INFO     manager on c7-dev: set hook exechost_periodic_logmsg {'freq': '3', 'enabled': 'True', 'event': 'exechost_periodic'}
2018-12-14 18:28:17,086 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c set hook exechost_periodic_logmsg freq=3,enabled=True,event=exechost_periodic
2018-12-14 18:28:17,129 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c list hook exechost_periodic_logmsg
2018-12-14 18:28:17,170 INFO     expect on server c7-dev: freq set 3 || enabled set True || event set exechost_periodic hook exechost_periodic_logmsg ...  OK
2018-12-14 18:28:17,171 INFO     manager on c7-dev: import hook exechost_periodic_logmsg {'content-type': 'application/x-python', 'input-file': '/tmp/PtlPbsaHnSRo', 'content-encoding': 'default'}
2018-12-14 18:28:17,171 INFOCLI  c7-dev: sudo -H /opt/pbs/bin/qmgr -c import hook exechost_periodic_logmsg application/x-python default /tmp/PtlPbsaHnSRo
2018-12-14 18:28:17,206 INFO     server c7-dev: imported hook body
---
import pbs
e = pbs.event()
pbs.logmsg(pbs.LOG_DEBUG,                                  'executed exechost_periodic hook')
e.accept()
---
2018-12-14 18:28:17,207 INFOCLI  c7-dev: sudo -H -u pbsuser /opt/pbs/bin/qsub -l select=ncpus=1 -- /bin/sleep 1
2018-12-14 18:28:17,237 INFO     submit to c7-dev as pbsuser: job 3075.c7-dev OrderedDict([('Resource_List.select', 'ncpus=1')])
2018-12-14 18:28:17,243 INFO     mom c7-dev log match: searching for "Job;3075.c7-dev;executed execjob_end hook" - No match
2018-12-14 18:28:19,351 INFO     mom c7-dev log match: searching for "Job;3075.c7-dev;executed execjob_end hook"... OK
2018-12-14 18:28:19,352 INFO     ERROR

2018-12-14 18:28:19,352 INFO     ===================================
2018-12-14 18:28:19,352 INFO      Entered TestPbsExecjobEnd tearDown
2018-12-14 18:28:19,352 INFO     ===================================
2018-12-14 18:28:19,352 INFO     ====================================
2018-12-14 18:28:19,352 INFO     Completed TestPbsExecjobEnd tearDown
2018-12-14 18:28:19,353 INFO     ====================================
2018-12-14 18:28:19,353 INFO     
2018-12-14 18:28:19,353 INFO     ======================================================================
2018-12-14 18:28:19,353 INFO     ERROR: test_execjob_end_non_blocking (tests.functional.pbs_hook_execjob_end.TestPbsExecjobEnd)

2018-12-14 18:28:19,353 INFO     ___m_oo_m___
2018-12-14 18:28:19,354 INFO     Traceback (most recent call last):
  File "/home/mohammh/github/riyazhakki/pbspro/test/tests/functional/pbs_hook_execjob_end.py", line 83, in test_execjob_end_non_blocking
    date_time1, '%m/%d/%Y %H:%M:%S')))
NameError: global name 'date_time1' is not defined


2018-12-14 18:28:19,354 INFO     ================================================================================
error: test_execjob_end_non_blocking (tests.functional.pbs_hook_execjob_end.TestPbsExecjobEnd)
Test cases with failures: TestPbsExecjobEnd.test_execjob_end_non_blocking
Test suites with failures: TestPbsExecjobEnd
run: 3, succeeded: 2, failed: 0, errors: 1, skipped: 0, timedout: 0
Tests run in 0:00:50.330722
2018-12-14 18:28:19,354 INFO     Cleaning up temporary files
2018-12-14 18:28:19,354 INFO     Cleaning up /var/tmp dir
2018-12-14 18:28:19,369 INFO     Cleaning up /tmp dir
